<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Article" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="twitter:card" content="summary">

<!-- Schema.org markup for Google+ -->
<!-- Twitter Card data -->
<!-- Open Graph data -->

    <meta name="google-site-verification" content="GK5cKdKe-CQEFsGx1pPxHFhflO88ddWG8NdWk_KDabA" />
    
    <title>Create a Database Field - </title>
    <meta property="og:title" content="Create a Database Field - ">
    <meta name="twitter:title" content="Create a Database Field - ">
    <meta itemprop="name" content="Create a Database Field - ">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="">
    <meta property="og:site_name" content="Create a Database Field" >
    <meta property="og:url" content="/tutorials/code/create-plugin/db-model.html" >
    
  
    <meta name="description" content=" ...">
    <meta property="og:description" content=" ..." >
    <meta name="twitter:description" content=" ...">  
    <meta itemprop="description" content=" ...">
  
    
  
    <meta property="og:image" content="/default_preview.png">
    <meta name="twitter:image" content="/default_preview.png">
    <meta itemprop="image" content="/default_preview.png">
  
  
  <meta name="twitter:site" content="@lynnnoton">
  <meta name="twitter:creator" content="@lynnnoton">

  
    <!-- 
    
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

    
    -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="https://use.fontawesome.com/ee2438614b.js"></script>
       
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?autoload=true&amp;skin=sunburst&amp;lang=css" defer="defer"></script>


    <script>
        (function() {
          var cx = '006109472892303620439:hmwpm8s4lvi';
          var gcse = document.createElement('script');
          gcse.type = 'text/javascript';
          gcse.async = true;
          gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(gcse, s);
        })();
    </script>
      
    <script src="/scripts/default.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css">
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css">


    <link rel="stylesheet" type="text/css" href="/css/style.css"></link>
    <link rel="stylesheet" type="text/css" href="/css/tables.css"></link>
    <link rel="stylesheet" type="text/css" href="/css/prettify.css"></link>
    
    
      <link rel="shortcut icon" href="/images/favicon.ico">
      <link rel="apple-touch-icon" href="/images/touchicon_57.png">
      <link rel="apple-touch-icon" sizes="72x72" href="/images/touchicon_62.png">
      <link rel="apple-touch-icon" sizes="114x114" href="/images/touchicon_114.png">
      
      
  </head>

  <body>

      <a name="top"></a>     
         
         
                               
                      <div class="titlebox">
                                                    
                         <div class="blogtitle">
                          
                              <a href="">AresMUSH</a> 
                              
                          </div>
                          
                          <div class="tagline">
                                A New Breed of MUSH Server            
                            </div>
                            
                            </div>
                             
                      
                            <nav class="navbar navbar-dark">
 
    <ul class="nav navbar-nav">
      <li class="active">
        <a href="/">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Features <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/features/">Why Ares?</a></li>
          <li><a href="/features/ares-for-players.html">Ares for Players</a></li>
          <li><a href="/features/ares-for-admins.html">Ares for Admins</a></li>
          <li><a href="/features/ares-for-coders.html">Ares for Coders</a></li>
          <li><hr/></li>
          <li><a href="/web-portal">The Web Portal</a></li>
          <li><a href="/features/skills.html">Skills Systems</a></li>
          <li><a href="/handles">Player Handles</a></li>
          <li><a href="/features/server-roundup.html">Server Comparison</a></li>
        </ul>
      </li>  
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/mush-101">MUSH 101</a></li>
          <li><a href="/tutorials/play">Playing Ares</a></li>
          <li><a href="/tutorials/install">Installing Ares</a></li>
          <li><a href="/tutorials/config">Configuring Ares</a></li>
          <li><a href="/tutorials/manage">Managing Ares</a></li>
          <li><a href="/tutorials/code">Coding for Ares</a></li>
        </ul>
      </li>    
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">FS3 <span class="caret"></span></a>

        <ul class="dropdown-menu">
          <li><a href="/fs3/">FS3 Home</a></li>
          <li><a href="/fs3/fs3-3/">Player's Guide</a></li>
          <li><a href="/fs3/fs3-3/roll-quickref.html">Skills Quick Reference</a></li>
          <li><a href="/fs3/fs3-3/combat-quickref.html">Combat Quick Reference</a></li>
          <li><a href="/fs3/fs3-3/combat-walkthrough.html">Interactive Combat Walkthrough</a></li>
          <li><a href="/fs3/old-editions.html">Prior Edition Guides</a></li>
        </ul>
      </li>
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Code <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/code/">Source Code</a></li>
          <li><a href="/tutorials/code">Learn to Code</a></li>
          <li><a href="https://github.com/AresMUSH/aresmush/releases">Release Notes <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        </ul>
      </li>
      
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Community <span class="caret"></span></a>
        
        <ul class="dropdown-menu">
          <li><a href="http://arescentral.aresmush.com">AresCentral Directory <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
          <li><a href="http://forum.aresmush.com">Discussion Forum <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
          <li><a href="http://logcleaner.aresmush.com/">RP Log Cleaner <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        </ul>
      </li>

      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/feedback.html">Contact Us</a>
          <li><a href="/license.html">License</a>
          <li><a href="/privacy.html">Privacy Policy</a>
        </ul>
      </li>

    </ul>
</nav>

                      
                        
         
         <div class="page-block">
         
                           <div class="row">
                         
                         
    <div class="col col-sm-9">   

                               
             <div class="page">
                 
                 <h1>Create a Database Field</h1>
                 
                 <div class="fs3-shortcut">
                     <a href="#toc">(View Table of Contents)</a>
                 </div>
                 

                     <p>We’ll need to save character abilities to the database, which entails some new database fields.</p>

<h2 id="storing-a-hash">Storing a Hash</h2>

<p>The simplest approach would just be to create a single hash on the Character model and store all the ability data there, like so:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Character</span>
  <span class="n">attribute</span> <span class="ss">:cortex_abilities</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">DataType</span><span class="o">::</span><span class="no">Hash</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="p">{}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>To update someone’s strength, you’d have to do something like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">old_abilities</span> <span class="o">=</span> <span class="n">char</span><span class="p">.</span><span class="nf">cortex_abilities</span>
<span class="n">old_abilities</span><span class="p">[</span><span class="s1">'attributes'</span><span class="p">][</span><span class="s1">'strength'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'d6'</span>
<span class="n">char</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="ss">cortex_abilities: </span><span class="n">old_abilities</span><span class="p">)</span>
</code></pre></div></div>

<p>This works, but it’s a little clunky.  You have to load and save <em>all</em> abilities as a batch, even if you’re just changing one.  And it’s prone to typos.  If you do ‘atributes’ instead of ‘attributes’, you won’t get an error message but the code will just not update the data properly.</p>

<h2 id="storing-models">Storing Models</h2>

<p>A better way is to use specialized database models.  The Cortex plugin define several model classes for this purpose. Let’s look at one of them - CortexSkill - in detail.</p>

<h3 id="model-definition">Model Definition</h3>

<p>First we have the class definition.  Inheriting from <code class="language-ruby highlighter-rouge"><span class="no">Ohm</span><span class="o">::</span><span class="no">Model</span></code> is what makes it a database model – a class capable of storing data to the database – and including <code class="language-ruby highlighter-rouge"><span class="no">ObjectModel</span></code> provides access to a number of useful standard Ares database utilities.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CortexSkill</span> <span class="o">&lt;</span> <span class="no">Ohm</span><span class="o">::</span><span class="no">Model</span>
  <span class="kp">include</span> <span class="no">ObjectModel</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="alert alert-success">
<p><i class="fa fa-info-circle"></i> <b>Tip</b></p>
<p>Ohm is the database library that helps us talk to the database, and  <code>&lt; Ohm::Model</code>  is a special bit of Ruby code that lets us do things like  <code>attribute :name</code>  to define a database field.  We didn't see Ohm::Model in the previous examples because we were adding to an existing model class (Character) defined by the engine.  Here, though, we're creating a brand new one.  You can learn more about the Ohm library in the [advanced database tutorial](/tutorials/code/database.html) when you're ready.  </p>
</div>

<h3 id="model-attributes">Model Attributes</h3>

<p>Next we have the model attributes - a name, step, specialties and the character the ability belongs to.  The <code class="language-ruby highlighter-rouge"><span class="n">index</span> <span class="ss">:name</span></code> statement creates an index on the name field, which just helps the database look things up faster.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">attribute</span> <span class="ss">:name</span>
  <span class="n">attribute</span> <span class="ss">:die_step</span>
  <span class="n">reference</span> <span class="ss">:character</span><span class="p">,</span> <span class="s2">"AresMUSH::Character"</span>
  <span class="n">index</span> <span class="ss">:name</span>
</code></pre></div></div>

<p>It’s expected that <code class="language-ruby highlighter-rouge"><span class="n">die_step</span></code> will be a step like ‘d2’, ‘d4’, etc. rather than a numeric value.</p>

<h3 id="character-reference">Character Reference</h3>

<p>The <code class="language-ruby highlighter-rouge"><span class="no">CortexSkill</span></code> class stores which character each ability belongs to, but we also want to be able to easily find all of a character’s skills.  To do this, we add a reverse reference in the Character model.  Since a character can have multiple skills, this reference uses the <code class="language-ruby highlighter-rouge"><span class="n">collection</span></code> type.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Character</span>
    <span class="n">collection</span> <span class="ss">:cortex_skills</span><span class="p">,</span> <span class="s2">"AresMUSH::CortexSkill"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This allows us to reference things both ways:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">char</span> <span class="o">=</span> <span class="no">Character</span><span class="p">.</span><span class="nf">find_one_by_name</span><span class="p">(</span><span class="s2">"Bob"</span><span class="p">)</span>

<span class="c1"># This gets us all of a character's skills</span>
<span class="n">char</span><span class="p">.</span><span class="nf">skills</span>
<span class="n">skill</span> <span class="o">=</span> <span class="n">char</span><span class="p">.</span><span class="nf">skills</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># This gets us back to the character (Bob)</span>
<span class="n">skill</span><span class="p">.</span><span class="nf">character</span>  
</code></pre></div></div>

<h3 id="saving-skills">Saving Skills</h3>

<p>To create a skill, we just need to create a new model object.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">char</span> <span class="o">=</span> <span class="no">Character</span><span class="p">.</span><span class="nf">find_one_by_name</span><span class="p">(</span><span class="s2">"Bob"</span><span class="p">)</span>
<span class="n">skill</span> <span class="o">=</span> <span class="no">CortexSkill</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Guns"</span><span class="p">,</span> <span class="ss">die_step: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">character: </span><span class="n">char</span><span class="p">)</span>
</code></pre></div></div>

<div class="alert alert-success">
<p><i class="fa fa-info-circle"></i> <b>Tip</b></p>
<p>This skill will automatically be added to Bob's skills collection; we don't need to do anything to make that happen.</p>
</div>

<p>To update a skill, first we have to find it.  There’s a utility in <code class="language-ruby highlighter-rouge"><span class="n">aresmush</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">cortex</span><span class="o">/</span><span class="n">helpers</span><span class="p">.</span><span class="nf">rb</span></code> that can help us with that:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">char</span> <span class="o">=</span> <span class="no">Character</span><span class="p">.</span><span class="nf">find_one_by_name</span><span class="p">(</span><span class="s2">"Bob"</span><span class="p">)</span>
<span class="n">skill</span> <span class="o">=</span> <span class="no">Cortex</span><span class="p">.</span><span class="nf">find_skill</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="s2">"Guns"</span><span class="p">)</span>
</code></pre></div></div>

<p>Once we have the skill model, we can update it or delete it:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">skill</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="ss">die_step: </span><span class="s1">'d4'</span><span class="p">)</span>
<span class="n">skill</span><span class="p">.</span><span class="nf">delete</span>
</code></pre></div></div>


                 <div class="tutorial-nav">
                     <p>This article is part of the <a href="/tutorials/code/create-plugin">Creating a Plugin</a> tutorial.</p>
    
                     <div class="pagination-block">
                         <ul>
                             
                             <li><a href="/tutorials/code/create-plugin/help-file.html"> &larr; Previous</a></li>
                             
            
                             <li><a href="/tutorials/code/create-plugin">Back to Start</a> </li>
            
        
                             
                             <li><a href="/tutorials/code/create-plugin/abilities-cmd.html">Next &rarr; </a></li>
                             
                         </ul>
                     </div>
    
                     <br/>
                 </div>
                 
             </div>             
                           </div>
              
              
                  <div class="col col-sm-3">
                      
                      
                      <a name="toc"></a>
                      <div class="sidebar fs3-sidebar"> 
                      
                        <div id="search-box">
  <!-- SearchBox widget will appear here -->
</div>
                      
                      <h2>Creating a Plugin</h2>
                      
                     
                      
                                          
                      
                                          
                      
                                          
                      
                                          
                      
                                          
                                          <ul>
  <li><a href="/tutorials/code/create-plugin/">Tutorial Overview</a></li>
  <li><a href="/tutorials/code/create-plugin/plugin-folder.html">Create a Plugin Folder</a></li>
  <li><a href="/tutorials/code/create-plugin/plugin-module.html">Create a Plugin Module</a></li>
  <li><a href="/tutorials/code/create-plugin/config-file.html">Create a Config File</a></li>
  <li><a href="/tutorials/code/create-plugin/help-file.html">Create a Help File</a></li>
  <li><a href="/tutorials/code/create-plugin/db-model.html">Create a Database Model</a></li>
  <li><a href="/tutorials/code/create-plugin/abilities-cmd.html">Create the Abilities Command</a></li>
  <li><a href="/tutorials/code/create-plugin/set-ability-cmd.html">Create the Set Ability Command</a></li>
  <li><a href="/tutorials/code/create-plugin/sheet-cmd.html">Create the Sheet Command</a></li>
  <li><a href="/tutorials/code/create-plugin/app-review-cmd.html">Expand the App Review Command</a></li>
  <li><a href="/tutorials/code/create-plugin/roll-cmd.html">Create the Roll Command</a></li>
  <li><a href="/tutorials/code/create-plugin/locale-file.html">Create a Translations File</a></li>
  <li><a href="/tutorials/code/create-plugin/cmd-dispatch.html">Create a Dispatch Link</a></li>
  <li><a href="/tutorials/code/create-plugin/next-steps.html">Next Steps</a></li>
</ul>

                                          
                      
                                          
                      
                  </div>
              </div>

              <div id="searchModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Search Results</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
       

       <div id="search-hits">
         <!-- Hits widget will appear here -->
       </div>


       <div id="search-pagination">
         <!-- Pagination widget will appear here -->
       </div>
       
       
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>


<script src="/scripts/search.js"></script>
<script>
  initializeSearch( 'NI38C577BA',
    '29793fd9084a3446072c14e471e32589',
    'aresmush.com',
    ' ' );
</script>
              
</div>


                          
              </div>
              
          </div>
          

          <div class="footer">
             <p> &copy;  2013 with help from the <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a> blog engine.
              </p>
          </div>
          
      
     
  </body>
</html>
